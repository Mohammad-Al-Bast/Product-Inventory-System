<% title = 'Suppliers - Product Inventory System'; pageScript = '/js/suppliers.js'; %>

    <script>
        // Initialize suppliers data from server
        window.suppliersData = <%- JSON.stringify(suppliers) %>;
    </script>

    <!-- Sidebar Navigation -->
    <%- include('partials/sidebar', { active: 'suppliers' }) %>

    <!-- Main Content -->
    <main class="main-content">
        <%- include('partials/header', { pageTitle: 'Suppliers', pageSubtitle: 'Manage your supplier network' }) %>

        <!-- Suppliers Controls -->
        <section class="controls-section">
            <div class="controls-left">
                <div class="search-box-large">
                    <i class="fas fa-search"></i>
                    <input type="text" id="supplierSearch" placeholder="Search suppliers by name...">
                </div>
                <div class="filter-group">
                    <select id="cityFilter" class="filter-select">
                        <option value="">All Cities</option>
                        <% 
                        // Get unique city-country combinations from suppliers
                        const citySet = new Set();
                        const cityOptions = [];
                        if (suppliers && suppliers.length > 0) {
                            suppliers.forEach(s => {
                                const key = `${s.city}|${s.country}`;
                                if (s.city && !citySet.has(key)) {
                                    citySet.add(key);
                                    cityOptions.push({ city: s.city, country: s.country });
                                }
                            });
                            cityOptions.sort((a, b) => a.city.localeCompare(b.city));
                        }
                        %>
                        <% cityOptions.forEach(opt => { %>
                            <option value="<%= opt.city %>"><%= opt.city %>, <%= opt.country %></option>
                        <% }); %>
                    </select>
                    <button class="btn-filter" id="clearFilters">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>
            </div>
            <div class="controls-right">
                <button class="btn-primary" id="addSupplierBtn">
                    <i class="fas fa-plus"></i> Add Supplier
                </button>
            </div>
        </section>

        <!-- Suppliers Grid -->
        <section class="suppliers-grid" id="suppliersGrid">
            <% if (suppliers && suppliers.length > 0) { %>
                <% 
                // Helper functions for supplier avatars
                function getInitials(name) {
                    if (!name) return "?";
                    const words = name.trim().split(/\s+/);
                    if (words.length === 1) {
                        return words[0].substring(0, 2).toUpperCase();
                    }
                    return (words[0][0] + words[1][0]).toUpperCase();
                }
                
                function getColorFromString(str) {
                    const colors = [
                        "#0F2854", "#1C4D8D", "#4988C4", "#2563eb", 
                        "#7c3aed", "#db2777", "#059669", "#d97706",
                        "#dc2626", "#0891b2", "#4f46e5", "#7c2d12"
                    ];
                    if (!str) return colors[0];
                    let hash = 0;
                    for (let i = 0; i < str.length; i++) {
                        hash = str.charCodeAt(i) + ((hash << 5) - hash);
                    }
                    return colors[Math.abs(hash) % colors.length];
                }
                %>
                <% suppliers.forEach(supplier => { %>
                    <div class="supplier-card" data-supplier-id="<%= supplier.id %>">
                        <div class="supplier-header">
                            <div class="supplier-avatar" style="background: <%= getColorFromString(supplier.name) %>;">
                                <span class="supplier-initials"><%= getInitials(supplier.name) %></span>
                            </div>
                            <div class="supplier-actions">
                                <button class="btn-icon edit" onclick="editSupplier(<%= supplier.id %>)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon delete" onclick="deleteSupplier(<%= supplier.id %>)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="supplier-body">
                            <h3><%= supplier.name %></h3>
                            <div class="supplier-detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span><%= supplier.address %>, <%= supplier.city %>, <%= supplier.state %> <%= supplier.zip %></span>
                            </div>
                            <div class="supplier-detail">
                                <i class="fas fa-phone"></i>
                                <span><%= supplier.phone %></span>
                            </div>
                            <div class="supplier-detail">
                                <i class="fas fa-envelope"></i>
                                <span><%= supplier.email %></span>
                            </div>
                            <% if (supplier.website) { %>
                                <div class="supplier-detail">
                                    <i class="fas fa-globe"></i>
                                    <span><a href="<%= supplier.website %>" target="_blank"><%= supplier.website %></a></span>
                                </div>
                            <% } %>
                            <% if (supplier.notes) { %>
                                <div class="supplier-detail">
                                    <i class="fas fa-sticky-note"></i>
                                    <span><%= supplier.notes %></span>
                                </div>
                            <% } %>
                            <div class="supplier-stats">
                                <div class="stat-item">
                                    <span class="stat-value"><%= supplier.country %></span>
                                    <span class="stat-label">Country</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value active">Active</span>
                                    <span class="stat-label">Status</span>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-building"></i>
                    <p>No suppliers found. Add your first supplier to get started!</p>
                </div>
            <% } %>
        </section>
    </main>

    <%- include('partials/modals/supplierModal') %>

    <%- include('partials/modals/deleteModal') %>