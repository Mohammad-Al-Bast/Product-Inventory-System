<% title = 'Dashboard - Product Inventory System'; pageScript = '/js/dashboard.js'; %>

    <script>
        // Initialize dashboard data from server
        window.dashboardData = {
            totalProducts: <%= stats.totalProducts %>,
            totalSuppliers: <%= stats.totalSuppliers %>,
            lowStockItems: <%= stats.lowStockCount %>,
            inventoryValue: <%= stats.inventoryValue %>
        };
    </script>

    <!-- Sidebar Navigation -->
    <%- include('partials/sidebar', { active: 'dashboard' }) %>

    <!-- Main Content -->
    <main class="main-content">
        <%- include('partials/header', { pageTitle: 'Dashboard', pageSubtitle: 'Welcome back, Mohammad!' }) %>

        <!-- Statistics Cards -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <i class="fas fa-box"></i>
                </div>
                <div class="stat-details">
                    <h3>Total Products</h3>
                    <p class="stat-number" id="totalProducts"><%= stats.totalProducts %></p>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> Active inventory
                    </span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon green">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="stat-details">
                    <h3>Total Suppliers</h3>
                    <p class="stat-number" id="totalSuppliers"><%= stats.totalSuppliers %></p>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> Active partners
                    </span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon yellow">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-details">
                    <h3>Low Stock Items</h3>
                    <p class="stat-number" id="lowStockItems"><%= stats.lowStockCount %></p>
                    <span class="stat-change <%= stats.lowStockCount > 0 ? 'negative' : 'positive' %>">
                        <i class="fas fa-<%= stats.lowStockCount > 0 ? 'arrow-down' : 'check' %>"></i> 
                        <%= stats.lowStockCount > 0 ? 'Needs attention' : 'All good' %>
                    </span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon purple">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-details">
                    <h3>Total Inventory Value</h3>
                    <p class="stat-number" id="inventoryValue">$<%= stats.inventoryValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %></p>
                    <span class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> Total value
                    </span>
                </div>
            </div>
        </section>

        <!-- Low Stock Alerts -->
        <section class="alert-section">
            <div class="section-header">
                <h2><i class="fas fa-exclamation-circle"></i> Low Stock Alerts</h2>
                <a href="/products" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="alert-list" id="alertList">
                <% if (alerts && alerts.length > 0) { %>
                    <% alerts.forEach(alert => { %>
                        <div class="alert-item <%= alert.urgency %>">
                            <div class="alert-icon">
                                <i class="fas fa-<%= alert.urgency === 'urgent' ? 'exclamation-triangle' : 'exclamation-circle' %>"></i>
                            </div>
                            <div class="alert-content">
                                <h4><%= alert.name %> - <%= alert.sku %></h4>
                                <p>Only <strong><%= alert.quantity %> units</strong> remaining</p>
                            </div>
                            <span class="alert-badge <%= alert.urgency %>"><%= alert.urgency === 'urgent' ? 'Urgent' : 'Warning' %></span>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="alert-item">
                        <div class="alert-content">
                            <p>No low stock alerts at this time!</p>
                        </div>
                    </div>
                <% } %>
            </div>
        </section>

        <!-- Suggested Items / Recent Activity -->
        <section class="suggested-section">
            <div class="section-header">
                <h2><i class="fas fa-star"></i> Suggested Items to Restock</h2>
                <a href="/products" class="view-all">View All Products <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="suggested-grid" id="suggestedGrid">
                <% if (suggestedItems && suggestedItems.length > 0) { %>
                    <% suggestedItems.forEach(product => { %>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="https://via.placeholder.com/200x200/4f46e5/ffffff?text=<%= encodeURIComponent(product.name.substring(0, 10)) %>" alt="<%= product.name %>">
                                <span class="product-badge low">Low Stock</span>
                            </div>
                            <div class="product-info">
                                <h3><%= product.name %></h3>
                                <p class="product-sku">SKU: <%= product.sku %></p>
                                <p class="product-supplier"><i class="fas fa-truck"></i> <%= product.supplier %></p>
                                <div class="product-stats">
                                    <span class="product-price">$<%= product.price.toFixed(2) %></span>
                                    <span class="product-quantity low">Qty: <%= product.quantity %></span>
                                </div>
                                <button class="btn-restock" onclick="window.location.href='/products'">
                                    <i class="fas fa-plus"></i> Restock
                                </button>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="product-card">
                        <div class="product-info">
                            <p>All items are well stocked!</p>
                        </div>
                    </div>
                <% } %>

            </div>
        </section>

        <!-- Recent Transactions -->
        <section class="transactions-section">
            <div class="section-header">
                <h2><i class="fas fa-exchange-alt"></i> Recent Activity</h2>
                <a href="/products" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="transaction-table">
                <table>
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Product</th>
                            <th>Type</th>
                            <th>Quantity</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="transactionList">
                        <% if (recentTransactions && recentTransactions.length > 0) { %>
                            <% recentTransactions.forEach(transaction => { %>
                                <tr>
                                    <td><%= transaction.date %></td>
                                    <td><%= transaction.productName %> (<%= transaction.sku %>)</td>
                                    <td><span class="type-badge <%= transaction.type %>"><%= transaction.type === 'update' ? 'Updated' : transaction.type %></span></td>
                                    <td><%= transaction.quantity %></td>
                                    <td><span class="status-badge <%= transaction.status %>"><%= transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1) %></span></td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="5" style="text-align: center;">No recent activity</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

